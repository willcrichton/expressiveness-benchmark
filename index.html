<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Expressiveness Benchmark</title><meta name="viewport" content="initial-scale=1.0, width=device-width"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-16662292-3"></script><script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag(&#x27;js&#x27;, new Date());

        gtag(&#x27;config&#x27;, &#x27;UA-16662292-3&#x27;);
        </script><meta name="next-head-count" content="5"/><link rel="preload" href="/expressiveness-benchmark/_next/static/css/923b377aad6d2aff8159.css" as="style"/><link rel="stylesheet" href="/expressiveness-benchmark/_next/static/css/923b377aad6d2aff8159.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/expressiveness-benchmark/_next/static/chunks/main-f76717e2d376ecc40880.js" as="script"/><link rel="preload" href="/expressiveness-benchmark/_next/static/chunks/webpack-95c2b224bccf352ee870.js" as="script"/><link rel="preload" href="/expressiveness-benchmark/_next/static/chunks/framework.be9133c4aa54b58ca1d2.js" as="script"/><link rel="preload" href="/expressiveness-benchmark/_next/static/chunks/commons.2ac40408ef03d6c65327.js" as="script"/><link rel="preload" href="/expressiveness-benchmark/_next/static/chunks/pages/_app-73821011f106e1ce2c2a.js" as="script"/><link rel="preload" href="/expressiveness-benchmark/_next/static/chunks/48fe5443.8cbf9bb7b72041d99e6c.js" as="script"/><link rel="preload" href="/expressiveness-benchmark/_next/static/chunks/29107295.0ba1e3749ecd6faab06a.js" as="script"/><link rel="preload" href="/expressiveness-benchmark/_next/static/chunks/f7f3ae4b7ca4f7fc373506a61db832ad86bd3f74.456f604e8bed4feda205.js" as="script"/><link rel="preload" href="/expressiveness-benchmark/_next/static/chunks/pages/index-26a3b32b3eff9cbc65d2.js" as="script"/></head><body><div id="__next"><div id="container"><div class="title"><h1><a href="/expressiveness-benchmark">Expressiveness Benchmark</a></h1><nav><span class="desktop-inline"><a href="/expressiveness-benchmark">Task matrix</a></span><span class="mobile-inline"><a href="/expressiveness-benchmark">Benchmark</a></span><a href="/expressiveness-benchmark/analysis">Dataset analysis</a></nav></div><div><p>This benchmark is a work-in-progress dataset of programs implementing tabular data analytics tasks, similar to <a href="https://rosettacode.org/">Rosetta Code</a> or <a href="https://eugenkiss.github.io/7guis/">7GUIs</a>. This benchmark has two goals:</p><ol><li><strong>Assist in cross-language learning.</strong> This benchmark provides an interface for easily comparing programs that do the same task in many languages.</li><li><strong>Quantify the relationship between programs and tasks.</strong> A preliminary analysis of program size compares the relative conciseness of each language.</li></ol><div class="desktop"><center><strong>Click on a task name</strong><span>or</span><strong>Click on a language</strong><span>or</span><strong>Read the <a href="/expressiveness-benchmark/analysis">analysis</a></strong></center></div><div class="mobile"><strong>Note:</strong> this site is optimized for large screens. Try it when you get the chance.</div><div class="desktop"><table class="matrix code-table"><thead><tr><th class="task-kind">Category</th><th class="task-kind">Task name</th><th class="hoverable">Python - Imperative</th><th class="hoverable">Python - Functional</th><th class="hoverable">Python - Pandas</th><th class="hoverable">R - Tidyverse</th><th class="hoverable">SQL - SQLite</th><th class="hoverable">Datalog - Souffle</th><th class="hoverable">Q - kdb+</th></tr></thead><tbody><tr><td class="task-type" rowspan="4">Aggregation</td><td class="task-description hoverable">Continent with the highest average population</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def continent_by_population(countries):
  continent_stats = defaultdict(lambda: [0, 0])
  for country in countries:
    continent = country[&#x27;continent&#x27;]
    continent_stats[continent][0] += country[&#x27;population&#x27;]
    continent_stats[continent][1] += 1
     
  max_continent = None
  max_average = None
  for continent, [total, count] in continent_stats.items():
    average = total / count
    if max_average is None or max_average &lt; average:
      max_average = average
      max_continent = continent
      
  return max_continent</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def continent_by_population(countries):
  continents = set([c[&#x27;continent&#x27;] for c in countries])
  populations_by_continent = [
    (continent, [c[&#x27;population&#x27;] for c in countries if c[&#x27;continent&#x27;] == continent])
    for continent in continents
  ]
  averages = [
    (continent, sum(pops) / len(pops))
    for continent, pops in populations_by_continent
  ]
  return max(averages, key=lambda t: t[1])[0]</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def continent_by_population(countries):
  mean_pop = countries.groupby(&#x27;continent&#x27;).population.mean()
  return mean_pop.index[mean_pop.argmax()]</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">continent_by_population &lt;- function(countries) {
  countries %&gt;%
    group_by(continent) %&gt;%
    summarize(mean_pop = mean(population)) %&gt;%
    slice(which.max(mean_pop)) %&gt;%
    .$continent
}</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">SELECT continent 
FROM countries
GROUP BY continent
ORDER BY AVG(population) DESC
LIMIT 1</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">.decl average_population(Continent:symbol, Avg:number)
average_population(Continent, Avg) :-
  countries(Continent, _, _),
  Total = sum P : countries(Continent, _, P),
  Num_countries = count : countries(Continent, _, _),
  Avg = Total / Num_countries.
  
continent_by_population(Continent) :- 
  countries(Continent, _, _), 
  average_population(Continent, Max_avg),
  Max_avg = max A : { countries(C, _, _), average_population(C, A) }.</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">averages: 
  select avg(population) by continent from countries;
continent_by_population: 
  (first select[&gt;population] continent from averages) `continent</pre></div></td></tr><tr><td class="task-description hoverable">First element that doesn&#x27;t change mean</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">

def get_mean(ls):
  sum = 0
  for e in ls:
    sum += e[&#x27;value&#x27;]
  return sum/len(ls)

def changing_mean(vals):
  start_mean = get_mean(vals)
  for i,elem in enumerate(vals):
    new_ls = vals[:i] + vals[i+1:]
    mean = get_mean(new_ls)
    if abs(mean - start_mean) &lt; 0.1:
      return i
  return None
</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">

def changing_mean(vals):
  start_mean = sum([l[&#x27;value&#x27;] for l in vals])/len(vals)
  diff = lambda m, sm: abs(m - sm)
    
  for i,elem in enumerate(vals):
    new_ls = [x[&#x27;value&#x27;] for x in vals if x != elem]
    mean = sum(new_ls)/len(new_ls)
    if diff(mean,start_mean) &lt; 0.1:
      return i
  return None
</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">

def changing_mean(vals):
  mean = vals.value.mean()
  mean_without = vals.apply(lambda row: vals[vals.id != row.id].value.mean(), axis=1)
  return vals[(mean_without - mean).abs() &lt; 0.1].id.tolist()
</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">library(data.table)
changing_mean &lt;- function(vals) {
   global_mean &lt;- mean(vals$value)
   setDT(vals)[, 
     mean_change := abs(global_mean - mean(vals[id != .BY, value])), 
     by = id] %&gt;%
     filter(mean_change &lt; 0.1) %&gt;%
     slice(which.min(id)) %&gt;%
     pull(id)
}</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">SELECT id
FROM vals v1
WHERE ABS((
  SELECT AVG(value)
  FROM vals v2
  WHERE v1.id != v2.id
) - (SELECT AVG(value) FROM vals)) &lt; 0.1</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">.decl avg_except(I:number, Avg:float)    
avg_except(I, Avg) :- 
  vals(I, _),
  N = sum 1.0 : { vals(J, _), I != J },
  Total = sum V : { vals(J, V), I != J },
  Avg = Total / N.
  
changing_mean(I) :-
  vals(I, _),
  N = sum 1.0 : vals(_, _),
  Total = sum V : vals(_, V),
  Avg = Total / N,
  avg_except(I, AvgExcept),
  ((Avg &gt; AvgExcept, Avg - AvgExcept &lt; 0.1);
   (Avg &lt; AvgExcept, AvgExcept - Avg &lt; 0.1)).</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">diffs: 
  {abs avg vals[`value] - avg (vals[`value] where vals[`id] &lt;&gt; x)} 
  each vals[`id];
  
changing_mean: first vals[`id] where diffs &lt; 0.1</pre></div></td></tr><tr><td class="task-description hoverable">Median population for each continent</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def continent_median_population(countries):
  populations = defaultdict(list)
  for country in countries:
    populations[country[&#x27;continent&#x27;]].append(country[&#x27;population&#x27;])
  
  output = []  
  for continent, pops in populations.items():
    pops.sort()
    N = len(pops)
    if N % 2 == 1:
      median = pops[(N - 1) // 2]
    else:
      median = (pops[N // 2 - 1] + pops[N // 2]) / 2
    output.append({
      &quot;continent&quot;: continent,
      &quot;population&quot;: median
    })
    
  return output</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def continent_median_population(countries):
  continents = set([c[&#x27;continent&#x27;] for c in countries])
  populations = {
    continent: [
      c[&#x27;population&#x27;] for c in countries 
      if c[&#x27;continent&#x27;] == continent
    ]
    for continent in continents
  }
  
  def compute_median(pops):
    pops = sorted(pops)
    N = len(pops)
    if N % 2 == 1:
      return pops[(N - 1) // 2]
    else:
      return (pops[N // 2 - 1] + pops[N // 2]) / 2  
   
  return [
    {&quot;continent&quot;: continent, &quot;population&quot;: compute_median(pops)}
    for continent, pops in populations.items()
  ]</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def continent_median_population(countries):
  return (countries
      .groupby(&#x27;continent&#x27;)
      .population.median()
      .reset_index())</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">continent_median_population &lt;- function(countries) {
  countries %&gt;%
    group_by(continent) %&gt;%
    summarize(population = median(population))
}</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">SELECT continent, AVG(population) as population
FROM
  (SELECT *, 
    row_number() OVER 
      (PARTITION BY continent ORDER BY population) AS rank, 
    count() OVER 
      (PARTITION BY continent) as count
  FROM countries)
WHERE 
  (count % 2 = 1 AND rank = (count + 1) / 2) OR 
  (count % 2 = 0 AND ABS(rank - 0.5 - count / 2) = 0.5)
GROUP BY continent</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">.decl unique_id(Country:symbol, Id:number)    
unique_id(Country, $) :- countries(_, Country, _).

.decl rank(Continent:symbol, R:number, Population:float)
rank(Continent, R_less + R_eq, Population) :-
  countries(Continent, Country, Population),
  unique_id(Country, Id),
  R_less = count : { 
    countries(Continent, C, P), 
    unique_id(C, Id2),
    P &lt; Population
  },
  R_eq = count : {
    countries(Continent, C, P), 
    unique_id(C, Id2),
    P = Population, 
    Id2 &lt; Id
  }.

continent_median_population(Continent, Median) :-
  countries(Continent, _, _),
  Num_countries = count : countries(Continent, _, _),
  ((Num_countries % 2 = 1, 
    rank(Continent, (Num_countries - 1) / 2, Median));
   (Num_countries % 2 = 0,
    rank(Continent, Num_countries / 2 - 1, P1),
    rank(Continent, Num_countries / 2, P2),
    Median = (P1 + P2) / 2)).     </pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">continent_median_population:
  () xkey select med[population] by continent from countries</pre></div></td></tr><tr><td class="task-description hoverable">Youngest person over 35</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def youngest_over_35(people):
  over_35 = []
  for person in people:
    if person[&#x27;age&#x27;] &gt; 35:
      over_35.append(person)
    
  youngest = None
  for person in over_35:
    if youngest is None or person[&#x27;age&#x27;] &lt; youngest[&#x27;age&#x27;]:
      youngest = person
  return youngest[&#x27;name&#x27;] if youngest is not None else None</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def youngest_over_35(people):
  over_35 = [p for p in people if p[&#x27;age&#x27;] &gt; 35]
  youngest = min(over_35, default=None, key=lambda p: p[&#x27;age&#x27;])
  return youngest[&#x27;name&#x27;] if youngest is not None else None</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def youngest_over_35(people):
  over_35 = people[people.age &gt; 35]
  if len(over_35) == 0: 
    return None
  else:
    youngest = over_35.loc[over_35.age.idxmin()]
    return youngest[&#x27;name&#x27;]</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">youngest_over_35 &lt;- function(people) {
  people %&gt;%
    filter(age &gt; 35) %&gt;%
    slice(which.min(age)) %&gt;%
    pull(name)
}</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">SELECT name
FROM people
WHERE age = (
  SELECT MIN(age)
  FROM people
  WHERE age &gt; 35)
LIMIT 1</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">youngest_over_35(Name) :- 
  people(Age, Name), 
  Age = min Age : { people(Age, _), Age &gt; 35 }.</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">old_enough: select from people where age &gt; 35
youngest_over_35: 
  (first select name from old_enough where age = min(age)) `name</pre></div></td></tr><tr><td class="task-type" rowspan="2">Joins</td><td class="task-description hoverable">Directors of movies Tom Hanks starred in</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">

def tom_hanks(actors,directors):
  r_directors = set()
  for a in actors:
    if &#x27;Tom Hanks&#x27; == a[&#x27;actor&#x27;]:
      for d in directors:
        if a[&#x27;movie&#x27;] == d[&#x27;movie&#x27;]:
          r_directors.add(d[&#x27;director&#x27;])
    return r_directors
</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">

def tom_hanks(actors,directors):
  movies = [a[&#x27;movie&#x27;] for a in actors if a[&#x27;actor&#x27;] == &#x27;Tom Hanks&#x27;]
  directors = [d[&#x27;director&#x27;] for d in directors if d[&#x27;movie&#x27;] in movies]
  return directors
</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">

def tom_hanks(actors,directors):
  movies = list(actors.loc[
    actors[&#x27;actor&#x27;] == &#x27;Tom Hanks&#x27;, &#x27;movie&#x27;])
  return directors[directors[&#x27;movie&#x27;].
    isin(movies)][&#x27;director&#x27;]
</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">tom_hanks &lt;- function(actors, directors) {
  actors %&gt;%
    filter(actor == &quot;Tom Hanks&quot;) %&gt;%
    inner_join(directors, by = &quot;movie&quot;) %&gt;%
    pull(director)
}</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">

SELECT directors.director
FROM 
  directors 
  INNER JOIN actors
  ON directors.movie = 
  actors.movie
WHERE actors.actor=&quot;Tom Hanks&quot;
</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">

tom_hanks(Director):-
  actors(&quot;Tom Hanks&quot;,movie),
  directors(Director,movie).
</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">tom_hanks:
  (select director from actors ij (`movie xkey directors) 
   where actor ~\: &quot;Tom Hanks&quot;) `director</pre></div></td></tr><tr><td class="task-description hoverable">Row per family to row per child</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">

def row_per_child(families):
  children = []
  for family in families:
    for i in [1, 2, 3]:
      children.append({
        &#x27;family&#x27;: family[&#x27;family&#x27;],
        &#x27;child&#x27;: f&#x27;child{i}&#x27;,
        &#x27;dob&#x27;: family[f&#x27;dob_child{i}&#x27;],
        &#x27;height&#x27;: family[f&#x27;height_child{i}&#x27;]
      })
  return children
</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def row_per_child(families):
  return [
    {&#x27;family&#x27;: family[&#x27;family&#x27;],
     &#x27;child&#x27;: f&#x27;child{i}&#x27;,
     &#x27;dob&#x27;: family[f&#x27;dob_child{i}&#x27;],
     &#x27;height&#x27;: family[f&#x27;height_child{i}&#x27;]}
    for family in families    
    for i in [1, 2, 3]
  ]</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def row_per_child(families):
  df = pd.wide_to_long(
    families, 
    stubnames=[&#x27;dob&#x27;, &#x27;height&#x27;], 
    sep=&quot;_child&quot;, 
    i=&#x27;family&#x27;, 
    j=&#x27;child&#x27;).reset_index()
  df.child = df.child.map(lambda c: f&#x27;child{c}&#x27;)
  return df</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">row_per_child &lt;- function(families) {
  families %&gt;%
    pivot_longer(
      !family,
      names_to = c(&quot;.value&quot;, &quot;child&quot;),
      names_sep = &quot;_&quot;,
    )
}</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">SELECT 
  family,
  (&#x27;child&#x27; || child) AS child,
  (CASE child 
    WHEN 1 THEN dob_child1 
    WHEN 2 THEN dob_child2 
    WHEN 3 THEN dob_child3 
   END) AS dob,
  (CASE child 
    WHEN 1 THEN height_child1 
    WHEN 2 THEN height_child2 
    WHEN 3 THEN height_child3 
   END) AS height
FROM 
  families
  CROSS JOIN
  (SELECT 1 as child UNION VALUES (2), (3))</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">row_per_child(&quot;child1&quot;, dob, family, height) :-
  families(dob, _, _, family, height, _, _).
row_per_child(&quot;child2&quot;, dob, family, height) :-
  families(_, dob, _, family, _, height, _).
row_per_child(&quot;child3&quot;, dob, family, height) :-
  families(_, _, dob, family, _, _, height).</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">child_rows: {[child] 
  rows: ?[families; (); 0b; `family`dob`height ! 
    (`family; `$(&quot;dob_child&quot;,child); `$(&quot;height_child&quot;, child))];
  update child: (count families)#enlist (&quot;child&quot;, child) from rows}
      
row_per_child: (child_rows each (&quot;1&quot;; &quot;2&quot;; &quot;3&quot;)) ,/;</pre></div></td></tr><tr><td class="task-type" rowspan="3">Strings</td><td class="task-description hoverable">Convert strings with different formats to numbers</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def strings_to_numbers(numbers):
  output = []
  for row in numbers:
    if row[&quot;format&quot;] == &#x27;comma_sep&#x27;:
      sep = &quot;,&quot;
    else:
      sep = &quot;_&quot;
    output.append(int(row[&quot;value&quot;].replace(sep, &quot;&quot;)))
  return output</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def strings_to_numbers(numbers):
  return [
    int(row[&quot;value&quot;].replace(
      &quot;,&quot; if row[&quot;format&quot;] == &quot;comma_sep&quot; else &quot;_&quot;, &quot;&quot;))
    for row in numbers
  ]</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def strings_to_numbers(numbers):
  def convert(row):
    sep = &quot;,&quot; if row.format == &#x27;comma_sep&#x27; else &quot;_&quot;
    return int(row.value.replace(sep, &quot;&quot;))
  return numbers.apply(convert, axis=1).tolist()</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">strings_to_numbers &lt;- function(numbers) {
  numbers %&gt;%
    mutate(output = as.numeric(str_replace_all(
      value, ifelse(format == &quot;comma_sep&quot;, &quot;,&quot;, &quot;_&quot;), &quot;&quot;))) %&gt;%
    pull(output)
}</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">SELECT 
  CAST(
    REPLACE(
      value, 
      CASE format 
        WHEN &quot;comma_sep&quot; THEN &quot;,&quot; 
        WHEN &quot;under_sep&quot; THEN &quot;_&quot; 
      END, &quot;&quot;)
    AS integer)
FROM numbers</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">.decl clean(Format:symbol, Inp:symbol, I:number, Outp:symbol) 
clean(Format, Inp, 0, &quot;&quot;) :- numbers(Format, Inp).
clean(Format, Inp, I+1, Outp) :-
  clean(Format, Inp, I, Outp_rec),
  I &lt;= strlen(Inp),
  Chr = substr(Inp, I, 1),
  ((Format = &quot;comma_sep&quot;, Sep = &quot;,&quot;);
   (Format = &quot;under_sep&quot;, Sep = &quot;_&quot;)),
  ((Chr  = Sep, Outp = Outp_rec);
   (Chr != Sep, Outp = cat(Outp_rec, Chr))).

strings_to_numbers(N) :-
  clean(Format, Inp, strlen(Inp), Outp),
  N = to_number(Outp).</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">convert: {[val; format] 
  sep: ((&quot;comma_sep&quot;; &quot;under_sep&quot;) ! (&quot;,&quot;; &quot;_&quot;)) format;
  &quot;J&quot; $ ssr[val; sep; &quot;&quot;]}
  
strings_to_numbers:
  convert&#x27;[numbers[`value]; numbers[`format]]</pre></div></td></tr><tr><td class="task-description hoverable">Documents with infrequent words</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def documents_with_infrequent_words(documents):
  words = {}
  freq = defaultdict(int)
  for doc in documents:
    words[doc[&quot;id&quot;]] = doc[&quot;text&quot;].split(&quot; &quot;)
    for word in words[doc[&quot;id&quot;]]:
      freq[word] += 1
      
  infrequent_words = set()
  for word, count in freq.items():
    if count == 1:
      infrequent_words.add(word)
      
  infrequent_docs = []
  for doc in documents:
    for word in words[doc[&quot;id&quot;]]:
      if word in infrequent_words:
        infrequent_docs.append(doc[&quot;id&quot;])
        break
        
  return infrequent_docs</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def documents_with_infrequent_words(documents):
  words = [doc[&quot;text&quot;].split(&quot; &quot;) for doc in documents]
  words_flat = [w for ws in words for w in ws]
  freq = {
    word: words_flat.count(word) 
    for word in set(words_flat)
  }
  infrequent_words = set([
    word for word, count in freq.items() 
    if count == 1
  ])
  infrequent_docs = [
    documents[i][&quot;id&quot;] for i, ws in enumerate(words) 
    if len(set(ws) &amp; infrequent_words) &gt; 0
  ]
  return infrequent_docs</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def documents_with_infrequent_words(documents):
  words = documents.text.str.split(&quot; &quot;, expand=True)
  freq = words.stack().value_counts()
  infrequent_words = freq[freq == 1].index.values
  infrequent_docs = documents[
    np.isin(words.values, infrequent_words)]
  return infrequent_docs.id.unique().tolist()</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">documents_with_infrequent_words &lt;- function(documents) {
  split &lt;- documents %&gt;%
    mutate(word = str_split(text, &quot; &quot;)) %&gt;%
    unnest()
  freq &lt;- split %&gt;% count(word)
  unique_words &lt;- freq %&gt;% filter(n == 1)
  split %&gt;% 
    filter(word %in% unique_words$word) %&gt;%
    pull(id) %&gt;%
    unique()
}</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">-- NOTE: SQLite tokenize is case-insensitive by default, 
-- so this solution is NOT exactly like the others

CREATE VIRTUAL TABLE doc_index USING fts4(
  text, id, content=documents, tokenize=simple);    
INSERT INTO doc_index(doc_index) VALUES(&#x27;rebuild&#x27;);
CREATE VIRTUAL TABLE words USING fts4aux(doc_index);    

SELECT DISTINCT id
FROM 
  documents
  CROSS JOIN
  (SELECT DISTINCT term
   FROM words
   WHERE occurrences = 1) unique_words
WHERE
  (LOWER(text) LIKE &#x27;% &#x27; || term || &#x27; %&#x27;) OR
  (LOWER(text) LIKE term || &#x27; %&#x27;) OR
  (LOWER(text) LIKE &#x27;% &#x27; || term) OR
  (LOWER(text) LIKE term)</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">.decl substrs(Text:symbol, Idx:number, Len:number)
substrs(Text, 0, 1) :- 
  documents(_, Text), strlen(Text) &gt; 0.
substrs(Text, 0, Len+1) :- 
  substrs(Text, 0, Len), Len + 1 &lt;= strlen(Text).
substrs(Text, Idx+1, Len) :- 
  substrs(Text, Idx, Len), Idx + Len + 1 &lt;= strlen(Text).

.decl token(Docid:number, Text:symbol, Idx:number, Word:symbol)
token(Docid, Text, Idx, Word) :-
  documents(Docid, Text),
  substrs(Text, Idx, Len),
  Prev = Idx - 1, Next = Idx + Len,
  (Prev &lt; 0; &quot; &quot; = substr(Text, Prev, 1)),
  (Next = strlen(Text); &quot; &quot; = substr(Text, Next, 1)),
  Word = substr(Text, Idx, Len),
  !contains(&quot; &quot;, Word).

documents_with_infrequent_words(Id) :-
  documents(Id, _),
  token(Id, _, _, Word),
  1 = count : token(_, _, _, Word).</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">words: (&quot; &quot; vs) each documents[`text];
freq: count each group raze words;
uniq: where[freq=1];
documents_with_infrequent_words:
  (select id from documents where &#x27;[any; in\: [;uniq]] each words) `id</pre></div></td></tr><tr><td class="task-description hoverable">Filter and clean tweets</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def process_tweets(data):
  result = []
  for value in data:
    if (value[&quot;language&quot;] == &quot;en&quot; and
        value[&quot;is_retweet&quot;] == &quot;false&quot;):
      result.append({
        &quot;body&quot;: value[&quot;body&quot;].lower(),
        &quot;ts&quot;: value[&quot;ts&quot;]
      })
  return result</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def process_tweets(data):
  return [
    {&quot;body&quot;: value[&quot;body&quot;].lower(),
     &quot;ts&quot;: value[&quot;ts&quot;]}
    for value in data
    if value[&quot;language&quot;] == &quot;en&quot; and
       value[&quot;is_retweet&quot;] == &quot;false&quot; 
  ]</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def process_tweets(data):
  result = data[
    (data.language == &#x27;en&#x27;) &amp;
    (data.is_retweet == &#x27;false&#x27;)]
  result.body = result.body.apply(lambda s: s.lower())
  return result[[&quot;body&quot;, &quot;ts&quot;]]</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">process_tweets &lt;- function(data) {
  data %&gt;%
    filter(language == &quot;en&quot; &amp; is_retweet == &quot;false&quot;) %&gt;%
    mutate(body = tolower(body)) %&gt;%
    select(ts, body)
}</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">SELECT LOWER(body) as body, ts
FROM data
WHERE language = &quot;en&quot; and is_retweet = &quot;false&quot;</pre></div></td><td class="task-code "></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">process_tweets:
  select lower[body], ts from data 
  where (is_retweet ~\: &quot;false&quot;) and (language ~\: &quot;en&quot;)</pre></div></td></tr><tr><td class="task-type" rowspan="2">First-order logic</td><td class="task-description hoverable">People that purchased all possible items</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def purchased_all_food(food, orders):
  n_food = len(food)
  unique_orders = defaultdict(set)
  for order in orders:
    unique_orders[order[&quot;buyer&quot;]].add(order[&quot;food&quot;])
      
  buyers = []
  for buyer, orders in unique_orders.items():
    if len(orders) == n_food:
      buyers.append(buyer)
  return buyers</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def purchased_all_food(food, orders):
    n_food = len(food)
    buyers = set([order[&quot;buyer&quot;] for order in orders])
    return [
        buyer
        for buyer in buyers
        if len(set([order[&quot;food&quot;] for order in orders 
             if order[&quot;buyer&quot;] == buyer])) == n_food
    ]</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def purchased_all_food(food, orders):
  n_food = len(food)
  n_unique_orders = (orders
    .groupby(&#x27;buyer&#x27;)
    .food.unique() 
    .map(len))
  return n_unique_orders[n_unique_orders == n_food].index.values</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">purchased_all_food &lt;- function(food, orders) {
  n_food &lt;- count(food)    
  orders %&gt;%
    group_by(buyer) %&gt;%
    distinct(food) %&gt;%
    count() %&gt;%
    filter(n == n_food) %&gt;%
    pull(buyer)
}</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">SELECT DISTINCT buyer
FROM orders o1
WHERE 
  (SELECT COUNT(DISTINCT food) FROM orders o2 
   WHERE o1.buyer = o2.buyer) = 
  (SELECT COUNT(*) FROM food)</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">.decl has_purchased(Buyer:symbol, Food:number)
has_purchased(Buyer, Food) :- orders(Buyer, Food, _).

purchased_all_food(Buyer) :-
  orders(Buyer, _, _),
  N_food = count : food(_, _),
  N_unique_orders = count : has_purchased(Buyer, _),
  N_food = N_unique_orders.</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">buyers: `buyer xgroup orders;
total: count food;
purchased_all_food:
  (where {(count distinct x[`food]) = total} each buyers) `buyer</pre></div></td></tr><tr><td class="task-description hoverable">People who like a unique set of beer</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def unique_beer_drinkers(likes):
  likes_per_person = defaultdict(set)
  for row in likes:
    likes_per_person[row[&#x27;name&#x27;]].add(row[&#x27;beer&#x27;])
    
  unique = []
  for p1, p1_likes in likes_per_person.items():
    is_unique = True
    for p2, p2_likes in likes_per_person.items():
      if p1 == p2:
        continue
        
      if p1_likes == p2_likes:
        is_unique = False
        break
    if is_unique:
      unique.append(p1)
      
  return unique</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def unique_beer_drinkers(likes):
  people = set([row[&#x27;name&#x27;] for row in likes])
  likes_per_person = {
    name: set([row[&#x27;beer&#x27;] for row in likes if row[&#x27;name&#x27;] == name])
    for name in people
  }
    
  return [
    name
    for name, beers in likes_per_person.items()
    if not any([
      other_name != name and beers == other_beers
      for other_name, other_beers in likes_per_person.items()
    ])
  ]</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def unique_beer_drinkers(likes):
  likes_per_person = (likes
    .groupby(&#x27;name&#x27;)
    .beer.unique().map(set)
    .reset_index())

  def check_not_exists(row):
    other_people = likes_per_person[
      likes_per_person.name != row[&#x27;name&#x27;]]
    return not (other_people.beer == row[&#x27;beer&#x27;]).any()
  
  unique_drinkers = likes_per_person[
    likes_per_person.apply(check_not_exists, axis=1)]
  return unique_drinkers.name.tolist()</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">unique_beer_drinkers &lt;- function(likes) {
  likes %&gt;%
    group_by(name) %&gt;%
    summarize(beer_set = list(sort(unique(beer)))) %&gt;%
    add_count(beer_set, name = &#x27;num_people_likes&#x27;) %&gt;%
    filter(num_people_likes == 1) %&gt;%
    pull(name)
}</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">SELECT DISTINCT L1.name
FROM likes L1
WHERE NOT EXISTS(
    SELECT *
    FROM likes L2
    WHERE L1.name != L2.name
    AND NOT EXISTS(
        SELECT *
        FROM likes L3
        WHERE L3.name = L2.name
        AND NOT EXISTS(
            SELECT *
            FROM likes L4
            WHERE L4.name = L1.name
            AND L4.beer = L3.beer))
    AND NOT EXISTS(
        SELECT *
        FROM likes L5
        WHERE L5.name = L1.name
        AND NOT EXISTS(
            SELECT *
            FROM likes L6
            WHERE L6.name = L2.name
            AND L6.beer= L5.beer)))</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">.decl differ(a:symbol, b:symbol)
differ(A, B) :- likes(Beer, A), likes(_, B), !likes(Beer, B).
differ(A, B) :- likes(_, A), likes(Beer, B), !likes(Beer, A).

.decl exists_same(a:symbol)
exists_same(Name) :- 
  likes(_, Other), 
  likes(_, Name), 
  Name != Other, 
  !differ(Name, Other).

unique_beer_drinkers(Name) :- 
  likes(_, Name), 
  !exists_same(Name).</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">likes_per_person: `name xgroup likes;
counts: count each group likes_per_person;
unique_beer_drinkers: 
  (select name from likes_per_person where beer in\: where[counts=1])
  `name</pre></div></td></tr><tr><td class="task-type" rowspan="2">Time Series</td><td class="task-description hoverable">Rolling average</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def rolling_average(data):
  data.sort(key=lambda v: v[&quot;time&quot;])
  result = []
  for i, value in enumerate(data):
    end = value[&quot;time&quot;]
    total, count = 0.0, 0
    for j in range(i, -1, -1):
      if data[j][&quot;time&quot;] &lt;= end - 7:
        break
      total += data[j][&quot;x&quot;]; count += 1
    result.append(
      {&quot;end_time&quot;: end,
       &quot;average&quot;: total / count}
    )
  return result</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def rolling_average(data):
  return [
    {&quot;end_time&quot;: x[&quot;time&quot;],
     &quot;average&quot;: sum(vs) / len(vs)}
    for x in data
    for vs in [
      [y[&quot;x&quot;] for y in data
              if y[&quot;time&quot;] &lt;= x[&quot;time&quot;] and
                 y[&quot;time&quot;] &gt; x[&quot;time&quot;] - 7]
    ]
  ]</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def rolling_average(data):
  d = data.copy()

  data.time = pd.to_datetime(data.time * 10**9)
  data = (data.sort_values(&#x27;time&#x27;).set_index(&#x27;time&#x27;)
              .rolling(window=&#x27;7s&#x27;).mean())

  return pd.DataFrame.from_dict(
    {&#x27;end_time&#x27;: d.sort_values(&#x27;time&#x27;).reset_index().time,
     &#x27;average&#x27;: data.reset_index().x}
  )</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">library(slider)
rolling_average &lt;- function(data) {
  data &lt;- arrange(data, time)
  avgs &lt;- unlist(slide_index(data$x, data$time, ~ mean(.x), .before = 6))
  data %&gt;% mutate(end_time = time, average = avgs) %&gt;% select(end_time, average)
}</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">SELECT
end.time as end_time,  AVG(other.x) as average
FROM data as end
JOIN data as other
ON other.time &lt;= end.time and
   other.time &gt; end.time - 7
GROUP BY end.time</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">.decl window(end_time: number, time: number)
window(end_time, t) :-
  data(end_time, _), data(t, _),
  t &lt;= end_time, t &gt; end_time - 7.
.decl bucket(end_time: number, total: float, n: float)
bucket(end_time, total, n) :- data(end_time, _),
  total = sum v : {data(t, v), window(end_time, t)},
      n = sum z : {data(t, _), window(end_time, t), z = 1.0}.
rolling_average(end_time, v) :-
  bucket(end_time, total, n), v = total / n.</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">get_avg: 
  {[t] (select avg(x) from data where time within (t - 6; t)) `x};
rolling_average: 
  select end_time: time, average: get_avg&#x27;[time] from data</pre></div></td></tr><tr><td class="task-description hoverable">Windowed average</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def average_window(data):
  def window(value):
    return math.floor(value[&quot;time&quot;] / 7)
  if len(data) &lt; 1:
    return []
  data.sort(key=lambda v: v[&quot;time&quot;])
  result = []
  current_window = window(data[0])
  total, count = data[0][&quot;x&quot;], 1
  for value in data[1:]:
    time_window = window(value)
    if time_window != current_window:
      result.append(total / count)
      current_window, total, count = time_window, 0, 0
    total += value[&quot;x&quot;]
    count += 1
  result.append(total / count)
  return result</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def average_window(data):
  def window(value):
    return math.floor(value[&quot;time&quot;] / 7)
  grouped_values = [
    [point[&quot;x&quot;] for point in data if window(point) == w]
    for w in set(map(window, data))
  ]
  return [
    sum(values) / len(values)
    for values in grouped_values
  ]</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def average_window(data):
  def window(t):
    return math.floor(t / 7)
  result = (data.sort_values(&quot;time&quot;)
                .set_index(&quot;time&quot;).groupby(window).mean())
  return result[&#x27;x&#x27;].tolist()</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">average_window &lt;- function(data) {
  data %&gt;% 
    group_by(floor(time / 7)) %&gt;% 
    summarize(avg = mean(x)) %&gt;% 
    pull(avg)
}</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">SELECT AVG(x) as x
FROM data
GROUP BY cast(time / 7 as int)
ORDER BY time</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">.decl window(w: number)
window(t/7) :- data(t, _).
.decl windowed(w: number, x: float)
windowed(t/7, x) :- data(t, x).
.decl windowed_total(w: number, x: float)
windowed_total(w, total / n) :- window(w),
  total = sum x : { windowed(w, x) },
      n = sum z : { windowed(w, x), z=1.0 }.
average_window(v) :- windowed_total(_, v).</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">average_window:
  (value select[&lt;time] avg x by 7 xbar time from data) `x</pre></div></td></tr><tr><td class="task-type" rowspan="2">Graphs</td><td class="task-description hoverable">Reflexive-transitive closure</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def reachable(graph, query):
  adjacency_list = defaultdict(list)
  for edge in graph:
    adjacency_list[edge[&quot;source&quot;]].append(edge[&quot;target&quot;])
  source = query[0][&quot;source&quot;]

  visited = set()
  to_visit = set([source])
    
  while len(to_visit) &gt; 0:
    current = to_visit.pop()
    if current in visited:
      continue
    for neighbor in adjacency_list[current]:
      to_visit.add(neighbor)
    visited.add(current)
            
  return list(visited)</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def reachable(graph, query):
  def step(visited):
    frontier = set([
      edge[&quot;target&quot;]
      for vertex in visited
      for edge in graph
      if vertex == edge[&quot;source&quot;]
    ])
    return frontier.union(visited)

  def fix(f, x):
    next = f(x)
    return x if next == x else fix(f, next)

  source = query[0][&quot;source&quot;]
  return list(fix(step, set([source])))</pre></div></td><td class="task-code "></td><td class="task-code "></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">WITH RECURSIVE
closure(source, target) AS (
  SELECT source, source FROM graph
  UNION
  SELECT source, target FROM graph
  UNION
  SELECT edge.source, path.target
  FROM closure as path JOIN graph as edge
  ON edge.target = path.source
)
SELECT S.target FROM closure as S
JOIN query ON S.source = query.source</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">.decl path(x: symbol, y: symbol)
path(x, y) :- graph(x, y).
path(x, y) :- graph(x, z), path(z, y).
reachable(source) :- query(source).
reachable(x) :- query(source), path(source, x).</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">graph: (first&#x27;) each graph;
nodes: asc distinct graph[`source], graph[`target];
adj_list: `source xgroup graph;
adj_matrix: 
  {in[;x] each nodes} each nodes ,&#x27; (adj_list each nodes) `target;
iterated_matrix: last ({x | any each (x *\: x)} \) adj_matrix;
query_idx: nodes ? (first first query[`source]);
reachable: nodes where iterated_matrix[query_idx]</pre></div></td></tr><tr><td class="task-description hoverable">Strongly-connected components</td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def scc(graph, query):
  reachable = set()
  vertices = set()
  for edge in graph:
    reachable.add((edge[&quot;source&quot;], edge[&quot;target&quot;]))
    vertices.add(edge[&quot;source&quot;])
    vertices.add(edge[&quot;target&quot;])
  changed = True
  while changed:
    changed = False
    for edge in graph:
      for vertex in vertices:
        if ((edge[&quot;source&quot;], vertex) not in reachable
            and (edge[&quot;target&quot;], vertex) in reachable):
          changed = True
          reachable.add((edge[&quot;source&quot;], vertex))
  source = query[0][&quot;source&quot;]
  result = []
  for vertex in vertices:
    if ((source, vertex) in reachable and
        (vertex, source) in reachable):
      result.append(vertex)
  return result</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">def scc(graph, query):
    def step(relation):
        return set([
            (source, edge[&quot;target&quot;])
            for (source, target) in relation
            for edge in graph
            if target == edge[&quot;source&quot;]
        ]).union(relation)

    def fix(f, x):
        next = f(x)
        return x if next == x else fix(f, next)

    source = query[0][&quot;source&quot;]
    init = set([(edge[&quot;source&quot;], edge[&quot;target&quot;]) for edge in graph])
    reachable = fix(step, init)
    return list(set([v for (_, v) in reachable
      if (v, source) in reachable and (source, v) in reachable]))</pre></div></td><td class="task-code "></td><td class="task-code "></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">WITH RECURSIVE
closure(source, target) AS (
  SELECT DISTINCT source, target FROM graph
  UNION
  SELECT edge.source, path.target
  FROM closure as path JOIN graph as edge
  ON edge.target = path.source
),
component(v1, v2) AS (
  SELECT path.source, path.target
  FROM closure as path JOIN closure as path_
  ON path.source = path_.target AND path.target = path_.source
)
SELECT S.v2 FROM component as S
JOIN query ON S.v1 = query.source</pre></div></td><td class="task-code "><div class="code-viewer"><div style="display:none"><div id="ace-editor" style="width:160px;height:100px"></div></div><pre style="width:160px;height:100px;line-height:1.3em;font-size:4px">.decl scc1(x: symbol, y: symbol)
scc1(x, x) :- vertex(x).
scc1(x, y) :- path(x, y), path(y, x).
.decl path(x: symbol, y: symbol)
path(x, y) :- graph(x, y).
path(x,y) :- graph(x, z), path(z, y).
.decl vertex(x: symbol)
vertex(x)  :- graph(x, _).
vertex(x)  :- graph(_, x).
scc(x) :- query(src), scc1(src, x).</pre></div></td><td class="task-code "></td></tr></tbody></table></div><div class="mobile"><div class="tasks-mobile"><h2>Aggregation</h2><ul><li><a href="/expressiveness-benchmark/task/continent_by_population">Continent with the highest average population</a></li><li><a href="/expressiveness-benchmark/task/changing_mean">First element that doesn&#x27;t change mean</a></li><li><a href="/expressiveness-benchmark/task/continent_median_population">Median population for each continent</a></li><li><a href="/expressiveness-benchmark/task/youngest_over_35">Youngest person over 35</a></li></ul></div><div class="tasks-mobile"><h2>Joins</h2><ul><li><a href="/expressiveness-benchmark/task/tom_hanks">Directors of movies Tom Hanks starred in</a></li><li><a href="/expressiveness-benchmark/task/row_per_child">Row per family to row per child</a></li></ul></div><div class="tasks-mobile"><h2>Strings</h2><ul><li><a href="/expressiveness-benchmark/task/strings_to_numbers">Convert strings with different formats to numbers</a></li><li><a href="/expressiveness-benchmark/task/documents_with_infrequent_words">Documents with infrequent words</a></li><li><a href="/expressiveness-benchmark/task/process_tweets">Filter and clean tweets</a></li></ul></div><div class="tasks-mobile"><h2>First-order logic</h2><ul><li><a href="/expressiveness-benchmark/task/purchased_all_food">People that purchased all possible items</a></li><li><a href="/expressiveness-benchmark/task/unique_beer_drinkers">People who like a unique set of beer</a></li></ul></div><div class="tasks-mobile"><h2>Time Series</h2><ul><li><a href="/expressiveness-benchmark/task/rolling_average">Rolling average</a></li><li><a href="/expressiveness-benchmark/task/average_window">Windowed average</a></li></ul></div><div class="tasks-mobile"><h2>Graphs</h2><ul><li><a href="/expressiveness-benchmark/task/reachable">Reflexive-transitive closure</a></li><li><a href="/expressiveness-benchmark/task/scc">Strongly-connected components</a></li></ul></div></div></div><footer>Project by <a href="https://twitter.com/wcrichton">Will Crichton</a>, <a href="https://github.com/kovach">Scott Kovach</a>, and <a href="http://gleb.fyi/">Gleb Shevchuk</a>.</footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/","query":{},"buildId":"vDR8ehcoSoupAMXzCtM3B","assetPrefix":"/expressiveness-benchmark","nextExport":true,"autoExport":true,"isFallback":false}</script><script nomodule="" src="/expressiveness-benchmark/_next/static/chunks/polyfills-d2769c16f665abc9d1ae.js"></script><script src="/expressiveness-benchmark/_next/static/chunks/main-f76717e2d376ecc40880.js" async=""></script><script src="/expressiveness-benchmark/_next/static/chunks/webpack-95c2b224bccf352ee870.js" async=""></script><script src="/expressiveness-benchmark/_next/static/chunks/framework.be9133c4aa54b58ca1d2.js" async=""></script><script src="/expressiveness-benchmark/_next/static/chunks/commons.2ac40408ef03d6c65327.js" async=""></script><script src="/expressiveness-benchmark/_next/static/chunks/pages/_app-73821011f106e1ce2c2a.js" async=""></script><script src="/expressiveness-benchmark/_next/static/chunks/48fe5443.8cbf9bb7b72041d99e6c.js" async=""></script><script src="/expressiveness-benchmark/_next/static/chunks/29107295.0ba1e3749ecd6faab06a.js" async=""></script><script src="/expressiveness-benchmark/_next/static/chunks/f7f3ae4b7ca4f7fc373506a61db832ad86bd3f74.456f604e8bed4feda205.js" async=""></script><script src="/expressiveness-benchmark/_next/static/chunks/pages/index-26a3b32b3eff9cbc65d2.js" async=""></script><script src="/expressiveness-benchmark/_next/static/vDR8ehcoSoupAMXzCtM3B/_buildManifest.js" async=""></script><script src="/expressiveness-benchmark/_next/static/vDR8ehcoSoupAMXzCtM3B/_ssgManifest.js" async=""></script></body></html>